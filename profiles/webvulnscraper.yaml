# webvulnscraper.yaml
# This file defines the configuration for interacting with the GPT API.
# It includes all necessary parameters, with the actual API keys stored in a separate keys.yaml file.

# Model to be used. 
model: gpt-4o-mini-2024-07-18
#model: gpt-4o-2024-08-06

credentials_file: ./keys.yaml
# External file where API keys are stored. This keeps the main configuration secure and clean.

system_prompt: |
  You are a web scraper specialized in succinctly collecting and collating relevant threat intelligence data and only the most critical and relevant links from various sources on the internet.
  Focus on concisely extracting and analyzing links or data that represents relevant information within the threat landscapes, ensuring outputs are concise and directly applicable to critical decision-making.
  Immediately disregard links that are generic, non-specific, irrelevant, etc. Only include links that are directly of the utmost important, are directly related, and that will have more specifically useful data. 
  Feel free to extract as many URLs from a page needed, as long as they're probably relevant.
  Be clear, concise, and short, but include all relevant details. 

parameters:
  max_tokens: 4000
  temperature: 0.95
  top_p: 0.95
  n: 3
  stop: None
  frequency_penalty: 0.05  # Controls how much the model penalises new tokens based on their existing frequency in the text so far.
  presence_penalty: 0.1 # Controls how much the model penalises new tokens based on whether they appear in the text so far.

structured_output:
  name: ThreatIntelligenceScraperSchema
  strict: true
  enable: true
  schema:
    type: object
    description: The root object containing all extracted threat intelligence data.
    properties:
      links:
        type:
          - array
          #- "null"
        description: An array of relevant links found, each with a URL, relevance score, description, and source.
        items:
          type: object
          description: An object representing a single link with its URL, relevance score, description, and discovery source.
          properties:
            url:
              type: string
              description: The full URL of the relevant link found.
            relevance_score:
              type: integer
              description: A score of 1 - 10 representing the relevance or importance of the link. Higher scores indicate higher relevance.
            description:
              type: string
              description: A succinct description of the specific threat intelligence this link should contain.
            source:
              type: string
              description: A descriptive source or method of how the link was found.
          required:
            - url
            - relevance_score
            - description
            - source
          additionalProperties: false
      data:
        type:
          - array
          #- "null"
        description: An array containing threat intelligence data objects extracted from the page.
        items:
          type: object
          description: An object detailing specific intelligence data including title, content, and threats.
          properties:
            title:
              type: string
              description: The title of the page or main content.
            content:
              type: string
              description: An extraction of the primary content focused on threat intelligence.
            summary:
              type: string
              description: A lossless, dense, concise summary of the main content, with a focus on threat intelligence and brevity.
            important:
              type: boolean
              description: Indicates if the content has the highest relevance or urgency.
            threatBreakdown:
              type: array
              description: An exhaustive breakdown of specific threats, exploits, or concerns mentioned in the content.
              items:
                type: object
                description: Each item in the array represents a specific threat or exploit, including details on its type, specificity, severity, and scope.
                properties:
                  threatType:
                    type: string
                    description: Summary of the type of threat.
                  description:
                    type: string
                    description: A detailed description of the threat, exploit, concern, or otherwise important information.
                  identifiers:
                    type:
                    - string
                    - "null"
                    description: Specific identifiers for this threat, such as a CVE.
                  severity:
                    type: string
                    description: The severity of the threat - CVSS v4 if possible.
                  scope:
                    type: string
                    description: Succinct, technical description to be able to determine decisively if we are exposed (vulnerable versions/release dates, IoCs, etc) - how do we tell?
                  source:
                    type: string
                    description: The source or context from where the content was extracted.
                required:
                  - threatType
                  - description
                  - identifiers
                  - severity
                  - scope
                  - source
                additionalProperties: false
            date:
              type: string
              description: The most relevant ISO 8601 date found in the content to assign to the scraped content.
          required:
            - title
            - content
            - summary
            - important
            - threatBreakdown
            - date
          additionalProperties: false
    required:
      - links
      - data
    additionalProperties: false

logging:
  enable: true
  log_level: INFO
  log_file: ./logs/api_calls.log

timeout: 10